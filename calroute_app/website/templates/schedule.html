<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Schedule</title>
    <link rel="stylesheet" href="/static/css/schedule.css">
     <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
    <div class="carousel-container">
        <h1>Welcome, {{ user.name }}!</h1>
        <div class="task-carousel-vertical">
            {% for task in user.raw_tasks %}
                <div class="task-card {% if task.completed %}done{% endif %}">
                    <button class="edit-btn" onclick="editTask('{{ task.raw_task_id }}')">✏️</button>
                    <h3>{{ task.title }}</h3>
                    <p>{{ task.description or "No description" }}</p>
                    <p><strong>Start:</strong> {{ task.start_time }}</p>
                    <p><strong>End:</strong> {{ task.end_time }}</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <div id="map"></div>
    <script>
    const orderedLocations = [
      { lat: 37.4221, lng: -122.0841 }, // Home
      { lat: 37.4268, lng: -122.0806 }, // Task 1
      { lat: 37.7749, lng: -122.4194 }, // Task 2
      { lat: 37.3382, lng: -121.8863 }  // Task 3
    ];

    let map;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10,
        center: orderedLocations[0],
      });

      const directionsService = new google.maps.DirectionsService();
      const directionsRenderer = new google.maps.DirectionsRenderer({
        map: map,
        suppressMarkers: false
      });

      const origin = orderedLocations[0];
      const destination = orderedLocations[orderedLocations.length - 1];
      const waypoints = orderedLocations.slice(1, -1).map(loc => ({
        location: loc,
        stopover: true,
      }));

      directionsService.route(
        {
          origin: origin,
          destination: destination,
          waypoints: waypoints,
          optimizeWaypoints: false, // Already optimized via Python
          travelMode: google.maps.TravelMode.DRIVING,
        },
        (response, status) => {
          if (status === "OK") {
            directionsRenderer.setDirections(response);
          } else {
            console.error("Directions request failed due to " + status);
          }
        }
      );
    }

    window.initMap = initMap;
  </script>

  <!-- Call initMap after loading -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_Dz0XtugoW2odkRb-QGaMT96bA0y9YJs&callback=initMap">
  </script>
    <script>
        function editTask(taskId) {
            alert('Edit task ' + taskId);
            // Redirect or open a modal as needed:
            // window.location.href = ⁠ /edit-task/${taskId} ⁠;
        }
    </script>
</body>
</html>